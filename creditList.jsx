//Credit List Generator, reading XMP Metadata from all Images. Indesign CS6 or later//(c) 2013 Kai Kasugaiapp.scriptPreferences.version = 8; //Indesign CS6 and later. Use 7.5 to use CS5.5 features//$.level = 2;var myDocument;myDocument = app.documents.item(0);var captionParagraphStyle = myDocument.paragraphStyles.itemByName("Bildunterschrift");var captionObjectStyle = myDocument.objectStyles.itemByName("Bild Umfluss Bounding Box");var xTolerance = 10; //maximum offset of the images to the text frame in Xvar yTolerance = 1; //maximum offset of the images to the text frame in Yvar allInfo = new Array();;//~ $.writeln(app.selection[0].appliedObjectStyle.name);//~ var test = app.selection[0].graphics[0];//~ $.writeln(app.selection[0].graphics[0].itemLink.name);for (var i = 0; i < myDocument.textFrames.count(); i++){    var currentTextFrame = myDocument.textFrames[i];        for (var p = 0; p < currentTextFrame.paragraphs.count(); p++){        var currentParagraph = currentTextFrame.paragraphs[p];        //Found a Paragraph with a caption?        if (currentParagraph.appliedParagraphStyle == captionParagraphStyle){            //Textframe, current Page and top Y Position to compare to images Y Positions on page            var theParentTextFrame = currentParagraph.parentTextFrames[0];            var theParentPage = theParentTextFrame.parentPage;            var topY = theParentTextFrame.geometricBounds[0];            var leftX = theParentTextFrame.geometricBounds[1];            var found = false;            var currentRectangle;            var currentGraphic;            var theInfo;                        //parse all rectangles on page            for (var r = 0; r < theParentPage.rectangles.count(); r++){                //see if the object style is correct and the X and Y Positions match within set tolerance                currentRectangle = theParentPage.rectangles[r];                if (currentRectangle.appliedObjectStyle == captionObjectStyle) {                    if (currentRectangle.geometricBounds[2] > topY - yTolerance && currentRectangle.geometricBounds[2] < topY + yTolerance) {                        if (currentRectangle.geometricBounds[1] > leftX - xTolerance && currentRectangle.geometricBounds[1] < leftX + xTolerance) {                            found = true;                                                        currentGraphic = currentRectangle.graphics[0].itemLink;                                                        //Name:                            theInfo = currentGraphic.name;                                                        //Copyright                            try{                                theInfo += ", (C) by " + currentGraphic.linkXmp.author;                            }                            catch(e) {                                                            }                                                        break;                        }                    }                }            }                        allInfo.push("Abbildung " + currentParagraph.numberingResultNumber + ", Seite " + theParentPage.name + ": " + (found ? theInfo : "NO IMAGE FOUND") + "\n");        }    }}allInfo.sort();$.writeln(allInfo);//NEXT: write user function to sort the text. add tabulators.